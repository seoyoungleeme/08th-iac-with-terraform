# 주제

IaC 개념과 등장 배경과 Terraform의 구성 요소와 동작 원리

# 요약

- 학습 내용을 간단하게 요약해 주세요.

# 학습 내용

## IaC 개념과 등장 배경

### IaC란 무엇인가

IaC는 IT 인프라스트럭처(서버, 네트워크, 스토리지, 클라우드 리소스 등)를 **코드(설정 파일, 선언문 등)로 정의하고 자동으로 프로비저닝(provisioning) 및 관리하는 방식**을 말한다.
예를 들어, 수작업으로 VM 만들고 네트워크 설정하고 보안그룹 설정하던 것을, 코드로 “이런 인프라가 있어야 한다”라고 선언하고 시스템이 자동으로 구성하도록 하는 방식이다.

### IaC 접근 방식

IaC에는 크게 두가지 접근 방식이 존재한다.

- 선언형(declarative) 방식: 인프라가 **어떤 상태여야 한다(What)** 만 정의하고, 내부적으로 어떤 순서로 작업할지는 도구가 판단하는 방식
- 명령형(imperative) 방식: 인프라를 만들기 위한 **어떻게(How)** 를 순서대로 정의하는 방식

### IaC의 장점

1. 쉬운 환경 복제
인프라 리소스를 사용할 수 있는 한 동일한 IaC를 사용하여 동일한 환경을 다른 위치의 다른 시스템에 배포할 수 있다.

Ex)
한 회사의 지역 지점에서 서버, 네트워킹 및 사용자 정의 구성을 포함한 전체 지사의 엔터프라이즈 환경을 설명하기 위해 IaC를 사용하고 있다고 가정하는 경우,
회사가 다른 지역 지점을 개설한 경우 IaC를 사용하여 똑같은 환경을 복제하고 신속하게 해당 지점을 온라인으로 운영 가능하게 만들 수 있음.

2. 구성오류 감소
수동 구성은 사람의 개입으로 인해 오류가 발생하기 쉽지만, IaC 코드 업데이트로 인한 오류가 있는 경우 코드베이스를 마지막으로 알려진 안정적인 구성 파일로 롤백하여 상황을 신속하게 해결할 수 있게한다.
또한 이전 애플리케이션 버전의 배포 등의 다른 이유로 이전 버전의 IaC 구성 파일을 사용하여 환경을 롤백할 수도 있다.

### 주의할 점 / 한계
- IaC 도구 및 작성된 코드가 복잡해지면 “인프라 코드” 자체의 유지보수가 문제될 수 있다.
- 코드화되지 않은 상황이 남아있으면 완전한 자동화가 어려울 수 있으며, 팀 문화 변화가 필요하다.
- 선언형 방식 선택 시 도구에 따라 내부 동작 방식이 추상화되어 있어 내부 로직을 잘 이해해야 한다.


## Terraform의 구성 요소와 동작 원리

### Terraform이란
Terraform은 HashiCorp에서 개발한 여러 클라우드 플랫폼(및 기타 인프라 제공자) 위에서 인프라를 코드로 정의하고 관리할 수 있게 해줄수 있는 오픈소스 IaC 도구이다.
Terraform의 주요 특징은 선언형 언어(HCL: HashiCorp Configuration Language) 기반으로 인프라를 정의하고, 여러 제공자(provider)를 통한 확장성, 그리고 인프라 상태(state)를 관리한다는 점이다.

### Terraform의 구성 요소 (Architecture)

- **Configuration files (설정 파일)**: 사용자가 정의하는 인프라 리소스의 코드(.tf 파일 등)입니다. HCL 언어로 “이런 리소스가 있어야 한다”라고 기술한다.
- **Core (Terraform Core)**: Terraform의 중심 엔진 부분으로, 설정 파일을 읽고, 현재 상태(state)를 읽고, 변경 계획(plan)을 생성하고, 실제 적용(apply)을 수행하는 역할을 한다.
- **Providers (공급자 플러그인)**: AWS, Azure, GCP, Kubernetes 등 실제 인프라 리소스를 제어할 수 있는 플러그인입니다. Core가 이들 플러그인을 통해 실제 API 호출을 실행한다.
- **State (상태 파일)**: Terraform이 인프라 리소스의 현재 상태를 추적하기 위해 저장하는 정보(.tfstate 파일 등). 이후에 변경이 있을 때 어떤 리소스를 추가·수정·삭제해야 할지 계산하는 데 사용된다.
- **Dependency graph (의존성 그래프)**: Terraform은 설정파일을 해석해서 리소스 간 의존관계를 파악하고, 리소스를 생성/변경/삭제할 때 안전한 순서를 결정한다.
- **Modules (모듈화 구성)**: 복잡한 인프라 구성을 재사용 가능하도록 코드 단위로 모듈화할 수 있는 기능이 있다.

### Terraform의 동작 원리 (Workflow)
Terraform이 “코드를 → 인프라 상태”로 바꾸는 흐름을 단계별로 보면 다음과 같다:

1. 사용자가 Terraform 설정 파일(.tf) 작성 → “이런 리소스들을 만들겠다” 선언
2. `terraform init` 명령으로 필요한 프로바이더(plugin) 다운로드 및 초기화
3. `terraform plan` 명령을 실행하면 Terraform Core가 현재 상태(state)와 설정파일을 비교해서 어떤 변화가 필요한지 계획(plan)을 생성
4. `terraform apply` 명령으로 실제로 리소스를 생성/변경/삭제합니다. 이 과정에서 Core가 Providers를 이용해 해당 인프라 제공자의 API를 호출
5. 적용 후 Terraform은 새롭게 갱신된 리소스 상태를 상태파일(state)에 저장합니다. 이후 다음 변경 시 이 상태를 기준으로 비교 진행
6. 필요에 따라 `terraform destroy` 명령으로 정의된 인프라 모두 제거도 가능

### Terraform 예시

```bash
# provider: AWS를 사용 선언
provider "aws" {
  region = "ap-northeast-2" # 서울 리전
}

# resource: EC2 인스턴스 1개 만들기
resource "aws_instance" "my_server" {
  ami           = "ami-0c55b159cbfafe1f0" # Ubuntu 이미지 ID
  instance_type = "t2.micro"
  tags = {
    Name = "example-server"
  }
}
```

**실행 명령어**
```bash
terraform init   # 초기화 (AWS랑 연결 준비)
terraform plan   # 어떤 리소스가 만들어질지 미리 보기
terraform apply  # 생성
```

# 추가

- 추가로 공유하고 싶은 내용을 작성해 주세요. (어떤 것이든 좋습니다!)
